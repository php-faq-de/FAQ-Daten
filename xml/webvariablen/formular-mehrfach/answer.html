<p>
Daten die ein Script aus Formularen übergeben bekommt, sollen meist in Datenbanken
gespeichert werden. Dabei sollen in der Regel Dubletten vermieden werden. Diese
können z.B. entstehen, wenn der User den URI neulädt, an den die Daten
übergeben wurden oder wenn er bei Netscape-Browsern die Größe des Browserfensters
ändert, was ebenfalls ein Neuladen bewirkt. Ein mögliches Verfahren
zur Vermeidung solcher Dubletten wird in der Frage "<a class="faq" href="http://www.php-faq.de/q-scripte-abstimmung.html">Wie kann ich eine schummelsichere Abstimmung codieren?</a>"
beschrieben (Einsatz einer Challenge), ein anderes mögliches Verfahren ist ein
Redirect per Location-Header nach der erfolgreichen Ausführung der gewünschten
Aktionen (z.B. Speichern der Daten in einer Datenbank).
</p>

<pre><span style="color: #000000; font-weight: bold;">&lt;?PHP</span>
<span style="color: #000000; font-weight: bold;">function</span> formular_ausgeben<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$error</span> = <span style="color: #ff0000;">''</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
   <span style="color: #0000ff;">$error</span> = <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$error</span>==<span style="color: #ff0000;">''</span><span style="color: #000000;">&#41;</span>?<span style="color: #ff0000;">''</span>:<span style="color: #ff0000;">'&lt;font color=&quot;#DD0000&quot;&gt;'</span>.<span style="color: #0000ff;">$error</span>.<span style="color: #ff0000;">'&lt;/font&gt;'</span>;
   <span style="color: #b1b100;">return</span> <span style="color: #ff0000;">'&lt;form action=&quot;script.php4&quot; method=&quot;POST&quot;&gt;
           '</span>.<span style="color: #0000ff;">$error</span>.<span style="color: #ff0000;">'
           Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;'</span>.<span style="color: #0000ff;">$_REQUEST</span><span style="color: #000000;">&#91;</span><span style="color: #ff0000;">'name'</span><span style="color: #000000;">&#93;</span>.<span style="color: #ff0000;">'&quot; /&gt;
           &lt;br /&gt;
           &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;OK&quot; /&gt;
           &lt;/form&gt;'</span>;
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> daten_speichern<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
   <a href="http://www.php3.de/global"><span style="color: #000066;">GLOBAL</span></a> <span style="color: #0000ff;">$db</span>;
   <span style="color: #b1b100;">if</span><span style="color: #000000;">&#40;</span><a href="http://www.php3.de/strlen"><span style="color: #000066;">strlen</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$_REQUEST</span><span style="color: #000000;">&#91;</span><span style="color: #ff0000;">'name'</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> &lt; <span style="color: #cc66cc;">3</span><span style="color: #000000;">&#41;</span>
   <span style="color: #000000;">&#123;</span>
      <span style="color: #b1b100;">return</span> formular_ausgeben<span style="color: #000000;">&#40;</span><span style="color: #ff0000;">'Bitte Namen eingeben!&lt;br&gt;'</span><span style="color: #000000;">&#41;</span>;
   <span style="color: #000000;">&#125;</span>
   <span style="color: #b1b100;">else</span>
   <span style="color: #000000;">&#123;</span>
      <span style="color: #808080; font-style: italic;">// Mit $db-&gt;escape_string() wird eine Funktion aufgerufen, die sicher stellt</span>
      <span style="color: #808080; font-style: italic;">// das möglicherweise in $_REQUEST['name'] enthaltene SQL-Fragmente nicht</span>
      <span style="color: #808080; font-style: italic;">// ausgeführt werden (siehe auch mysql_escape_string() ).</span>
      <span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">query</span><span style="color: #000000;">&#40;</span><span style="color: #ff0000;">&quot;INSERT INTO tabelle
                  SET name = '&quot;</span>.<span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">escape_string</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$_REQUEST</span><span style="color: #000000;">&#91;</span><span style="color: #ff0000;">'name'</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span>.<span style="color: #ff0000;">&quot;'&quot;</span><span style="color: #000000;">&#41;</span>;
&nbsp;
      <span style="color: #b1b100;">if</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">affected_rows</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> == <span style="color: #cc66cc;">1</span><span style="color: #000000;">&#41;</span>
      <span style="color: #000000;">&#123;</span>
         <a href="http://www.php3.de/header"><span style="color: #000066;">header</span></a><span style="color: #000000;">&#40;</span><span style="color: #ff0000;">'Location: http://domain.de/script.php4?d=bestaetigen'</span><span style="color: #000000;">&#41;</span>;
         <span style="color: #b1b100;">return</span> <span style="color: #ff0000;">'&lt;a href=&quot;http://domain.de/script.php4?d=bestaetigen&quot;&gt;weiter&lt;/a&gt;'</span>;
      <span style="color: #000000;">&#125;</span>
      <span style="color: #b1b100;">else</span>
      <span style="color: #000000;">&#123;</span>
         <span style="color: #b1b100;">return</span> formular_ausgeben<span style="color: #000000;">&#40;</span><span style="color: #ff0000;">'MySQL: '</span>.<span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">Error</span>.<span style="color: #ff0000;">'&lt;br&gt;'</span><span style="color: #000000;">&#41;</span>;
      <span style="color: #000000;">&#125;</span>
   <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> bestaetigung<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
   <span style="color: #b1b100;">return</span> <span style="color: #ff0000;">'Der Name wurde gespeichert.'</span>;
<span style="color: #000000;">&#125;</span>
&nbsp;
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$_REQUEST</span><span style="color: #000000;">&#91;</span><span style="color: #ff0000;">'submit'</span><span style="color: #000000;">&#93;</span> == <span style="color: #ff0000;">'OK'</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
   <a href="http://www.php3.de/echo"><span style="color: #000066;">echo</span></a> daten_speichern<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #b1b100;">elseif</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$_REQUEST</span><span style="color: #000000;">&#91;</span><span style="color: #ff0000;">'d'</span><span style="color: #000000;">&#93;</span> == <span style="color: #ff0000;">'bestaetigen'</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
   <a href="http://www.php3.de/echo"><span style="color: #000066;">echo</span></a> bestaetigung<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #b1b100;">else</span>
<span style="color: #000000;">&#123;</span>
   <a href="http://www.php3.de/echo"><span style="color: #000066;">echo</span></a> formular_ausgeben<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #000000; font-weight: bold;">?&gt;</span></pre>

<p>
Ein Neuladen nach erfolgreichem Abspeichern der Daten führt hier nur zur erneuten
Ausgabe der Bestätigung. Die Daten werden nicht erneut in die Datenbank geschrieben.
</p>

