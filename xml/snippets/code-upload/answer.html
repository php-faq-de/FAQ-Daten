<p>
Das Script muss einen Socket mit der Funktion
<a href="http://www.php3.de/fsockopen">fsockopen()</a> zum Zielserver öffnen und auf diesem
Socket dann einen HTTP POST-Request mit Datei-Upload simulieren.
</p>

<p>
Das Beispiel baut eine HTTP-Anfrage konform der multipart/form-data
Beschreibung auf und sendet diese dann ab. Dabei wird eine ASCII-Datei
eingelesen und übergeben.
</p>

<p>Bei multipart/form-data werden die Daten so übergeben:</p>

<pre>
...
Content-type: multipart/form-data; boundary=---------------------------255141413922088
Content-Length: 6881

-----------------------------255141413922088
Content-Disposition: form-data; name="disk"

off
-----------------------------255141413922088
...
-----------------------------255141413922088--
</pre>

<p>Dieses Stück Beispielcode sendet einen solchen Request ab:</p>

<pre>#!/usr/local/bin/php -q
&nbsp;
&lt;?php
&nbsp;
// Andreas Bohne-Lang / a.bohne@dkfz.de / 22.10.2001 / GPL
// Ergaenzt: 19.9.2003
&nbsp;
function PostToHost&#40;$host, $port, $path, $referer, $data_to_send&#41;
&#123;
    $dc = 0;
    bo=&quot;-----------------------------305242850528394&quot;;
&nbsp;
    $fp = fsockopen&#40;$host, $port, $errno, $errstr&#41;;
    if &#40;!$fp&#41; &#123;
        echo &quot;errno: $errno \n&quot;;
        echo &quot;errstr: $errstr\n&quot;;
        return $result;
    &#125;
&nbsp;
    fputs&#40;$fp, &quot;POST $path HTTP/1.0\n&quot;&#41;;
    fputs&#40;$fp, &quot;Host: $host\n&quot;&#41;;
    fputs&#40;$fp, &quot;Referer: $referer\n&quot;&#41;;
    fputs&#40;$fp, &quot;User-Agent: Mozilla/4.05C-SGI [en] (X11; I; IRIX 6.5 IP22)\n&quot;&#41;;
    fputs&#40;$fp, &quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*\n&quot;&#41;;
    fputs&#40;$fp, &quot;Accept-Charset: iso-8859-1,*,utf-8\n&quot;&#41;;
    fputs&#40;$fp, &quot;Content-type: multipart/form-data; boundary=$bo\n&quot;&#41;;
&nbsp;
    foreach&#40;$data_to_send as $key=&gt;$val&#41; &#123;
        $ds =sprintf&#40;&quot;--%s\nContent-Disposition: form-data; name=\&quot;%s\&quot;\n\n%s\n&quot;, $bo, $key, $val&#41;;
        $dc += strlen&#40;$ds&#41;;
    &#125;
    $dc += strlen&#40;$bo&#41;+3;
    fputs&#40;$fp, &quot;Content-length: $dc \n&quot;&#41;;
    fputs&#40;$fp, &quot;\n&quot;&#41;;
&nbsp;
    foreach&#40;$data_to_send as $key=&gt;$val&#41; &#123;
        $ds =sprintf&#40;&quot;--%s\nContent-Disposition: form-data; name=\&quot;%s\&quot;\n\n%s\n&quot;, $bo, $key, $val&#41;;
        fputs&#40;$fp, $ds &#41;;
    &#125;
    $ds = &quot;--&quot;.$bo.&quot;--\n&quot;;
    fputs&#40;$fp, $ds&#41;;
&nbsp;
    while&#40;!feof&#40;$fp&#41;&#41; &#123;
        $res .= fread&#40;$fp, 1&#41;;
    &#125;
    fclose&#40;$fp&#41;;
&nbsp;
    return $res;
&#125;
&nbsp;
// Für eine ASCII-Datei kann man es so machen
// bei bin-Daten über fread gehen
&nbsp;
$fa = @file&#40;&quot;http://www.dkfz.de/spec/fix/file.pdb&quot;&#41;;
&nbsp;
// Konkretes Beispiel - Eine Chemie-Datei
$xf=&quot;Content-Type: chemical/x-pdb\n\n&quot;. implode&#40;&quot;&quot;, $fa&#41;;
&nbsp;
$data&#91;&quot;disk&quot;&#93;            = &quot;on&quot;;
$data&#91;&quot;file\&quot;; filename=\&quot;irgendwas.pdb&quot;&#93;        = $xf;
$data&#91;&quot;smiles&quot;&#93;          = &quot;&quot;;
$data&#91;&quot;hadd&quot;&#93;            = &quot;add&quot;;
$data&#91;&quot;aroresolver&quot;&#93;     = &quot;on&quot;;
$data&#91;&quot;format&quot;&#93;          = &quot;gif&quot;;
$data&#91;&quot;interlace&quot;&#93;       = &quot;1&quot;;
$data&#91;&quot;width&quot;&#93;           = &quot;600&quot;;
$data&#91;&quot;height&quot;&#93;          = &quot;400&quot;;
$data&#91;&quot;atomcolor&quot;&#93;       = &quot;Black&quot;;
$data&#91;&quot;asymbol&quot;&#93;         = &quot;xsymbol&quot;;
$data&#91;&quot;hcolor&quot;&#93;          = &quot;&quot;;
$data&#91;&quot;csymbol&quot;&#93;         = &quot;special&quot;;
$data&#91;&quot;hsymbol&quot;&#93;         = &quot;special&quot;;
$data&#91;&quot;bondcolor&quot;&#93;       = &quot;Black&quot;;
$data&#91;&quot;bgcolor&quot;&#93;         = &quot;White&quot;;
$data&#91;&quot;border&quot;&#93;          = &quot;12&quot;;
$data&#91;&quot;bonds&quot;&#93;           = &quot;8&quot;;
$data&#91;&quot;wedges&quot;&#93;          = &quot;1&quot;;
$data&#91;&quot;dashes&quot;&#93;          = &quot;1&quot;;
$data&#91;&quot;crop&quot;&#93;            = &quot;2&quot;;
$data&#91;&quot;align&quot;&#93;           = &quot;none&quot;;
$data&#91;&quot;coord&quot;&#93;           = &quot;0&quot;;
$data&#91;&quot;imagemap&quot;&#93;        = &quot;none&quot;;
$data&#91;&quot;headercolor&quot;&#93;     = &quot;Black&quot;;
$data&#91;&quot;header&quot;&#93;          = &quot;&quot;;
$data&#91;&quot;footercolor&quot;&#93;     = &quot;Black&quot;;
$data&#91;&quot;footer&quot;&#93;          = &quot;&quot;;
$data&#91;&quot;commenttype&quot;&#93;     = &quot;none&quot;;
$data&#91;&quot;comment&quot;&#93;         = &quot;&quot;;
$data&#91;&quot;structure&quot;&#93;       = &quot;none&quot;;
&nbsp;
$x = PostToHost &#40;
    &quot;www2.chemie.uni-erlangen.de&quot;,
    80,
    &quot;/cgi-bin/services/gifcreator.tcl&quot;,
    &quot;http://www2.chemie.uni-erlangen.de/services/gifcreator/index.html&quot;,
    $data
&#41;;
&nbsp;
// Diesen Teil kann man bestimmt noch optimieren ;-)
$fp = fopen&#40;&quot;struktur.gif&quot;, &quot;wb&quot;&#41;;
$tok = 0;
for &#40;$i=20; $i&lt;strlen&#40;$x&#41;; $i++&#41;&#123;
    if &#40;&#40;substr&#40;$x,$i,1&#41;==&quot;\n&quot;&#41; || &#40;substr&#40;$x,$i,1&#41;==&quot;\r&quot;&#41;&#41; &#123;
        $tok++;
        if&#40;$tok&gt;=3&#41; break;
    &#125; else &#123;
        $tok=0;
    &#125;
&#125;
$i++; $i++;
printf&#40;&quot; %d %d %d \n&quot;, $i, strlen&#40;$x&#41;, strlen&#40;$x&#41;-$i&#41;;
fwrite&#40;$fp, substr&#40;$x,$i,strlen&#40;$x&#41;-$i&#41;&#41;;
fclose&#40;$fp&#41;;
&nbsp;
$fp = fopen&#40;&quot;struktur.xxx&quot;, &quot;wb&quot;&#41;;
fwrite&#40;$fp, $x, strlen&#40;$x&#41;&#41;;
fclose&#40;$fp&#41;;
&nbsp;
?&gt;</pre>

