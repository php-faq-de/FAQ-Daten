<p>Dem Skript liegt folgende Struktur der MySQL-Tabelle zugrunde:</p>

<pre>
mysql&gt; describe counter;
+-------+------------------+------+-----+---------+----------------+
| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned |      | PRI | 0       | auto_increment |
| url   | char(255)        |      |     |         |                |
| count | int(11)          |      |     | 0       |                |
+-------+------------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)
</pre>

<p>
Das Feld <tt>url</tt> enthält die URL, die aufgerufen wird. Das Feld
<tt>count</tt> enthält die Anzahl der Klicks auf <tt>url</tt>.
</p>

<pre>&lt;?php
&nbsp;
// Zugangsdaten fuer die Datenbank
// Diese sollten der Sicherheit halber
// in ein Verzeichnis außerhalb des
// Document-Root ausgelagert werden.
&nbsp;
$host     = &quot;localhost&quot;;
$user     = &quot;user&quot;;
$pass     = &quot;demo_password&quot;;
&nbsp;
$database = &quot;demo_db&quot;;
$table    = &quot;counter&quot;;
&nbsp;
// Die per GET übergebene URL einlesen
// In der Praxis wird hier geprüft, ob die URL überhaupt ok ist.
$url = $_GET&#91;'url'&#93;;
&nbsp;
// Verbindung zum MySQL-Server aufbauen
$db = mysql_connect&#40; $host, $user, $pass &#41;;
if &#40; !is_resource&#40; $db &#41; &#41; &#123;
    // handleSqlError() steht symbolisch für die Fehlerbehandlung.
    handleSqlError&#40;&#41;;
&#125;
&nbsp;
// Datenbank auswählen
if &#40; !mysql_select_db&#40; $database, $db &#41; &#41; &#123;
    handleSqlError&#40;&#41;;
&#125;
&nbsp;
// URL für den Transport zur Datenbank maskieren
$safe_url = &quot;'&quot; . mysql_real_escape_string&#40; $url &#41; . &quot;'&quot;;
&nbsp;
// Eintrag fuer die übergebene URL um 1 erhöhen.
$query = &quot;UPDATE $table SET count=count+1 WHERE url=$safe_url&quot; 
$result = mysql_query&#40; $query, $db &#41; || handleSqlError&#40;&#41;;
&nbsp;
// Noch kein Eintrag für die URL vorhanden?
if &#40; mysql_affected_rows&#40; $db &#41; == 0 &#41; &#123;
    $query = &quot;INSERT INTO $table (url, count) VALUES ($safe_url, 1)&quot;;
    mysql_query&#40; $query, $db &#41; || handleSqlError&#40;&#41;;
&#125;
&nbsp;
// Auf übergebene URL weiterleiten
header&#40; &quot;Location: &quot; . $url &#41;;
?&gt;</pre>

<p>Anwendungsbeispiel:</p>

<pre>&lt;a href=&quot;count.php?url=http://www.martin-jansen.de&quot;&gt;Link&lt;/a&gt;</pre>

<p>
Als Parameter für die Datei count.php wird die URL übergeben, auf
die weitergeleitet werden soll. In count.php wird nun der Datensatz
in der Tabelle, der <tt>$url</tt> als Wert für das Feld <tt>url</tt> enthält
um 1 erhöht und es wird auf die neue URL weitergeleitet.
</p>
