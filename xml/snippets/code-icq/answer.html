<p>
Es gibt einige fertige Scripte, die mit Hilfe von PHP testen können,
ob eine bestimmte UIN online ist. Die meisten dieser Scripte
funktionieren allerdings nicht mehr, weil ICQ (wieder einmal) etwas
verändert hat. Der Server liefert auch weiterhin Redicts auf
die Bildchen, allerdings hat sich die URL geändert.
</p>

<p>
Das folgende Script wertet die Redirects aus:
</p>

<pre><span style="color: #000000; font-weight: bold;">function</span> GetICQ<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$uin</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #000000;">&#40;</span>!<a href="http://www.php3.de/is_numeric"><span style="color: #000066;">is_numeric</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$uin</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #000000; font-weight: bold;">FALSE</span>;
&nbsp;
    <span style="color: #0000ff;">$fp</span> = <a href="http://www.php3.de/fsockopen"><span style="color: #000066;">fsockopen</span></a><span style="color: #000000;">&#40;</span><span style="color: #ff0000;">'status.icq.com'</span>, <span style="color: #cc66cc;">80</span>, &amp;<span style="color: #0000ff;">$errno</span>, &amp;<span style="color: #0000ff;">$errstr</span>, <span style="color: #cc66cc;">8</span><span style="color: #000000;">&#41;</span>;
    <span style="color: #b1b100;">if</span> <span style="color: #000000;">&#40;</span>!<span style="color: #0000ff;">$fp</span><span style="color: #000000;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #000000; font-weight: bold;">FALSE</span>;
&nbsp;
    <span style="color: #0000ff;">$request</span> = <span style="color: #ff0000;">&quot;HEAD /online.gif?icq=$uin HTTP/1.0<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>
              .<span style="color: #ff0000;">&quot;Host: web.icq.com<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>
              .<span style="color: #ff0000;">&quot;Connection: close<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>;
    <a href="http://www.php3.de/fputs"><span style="color: #000066;">fputs</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$fp</span>, <span style="color: #0000ff;">$request</span><span style="color: #000000;">&#41;</span>;
&nbsp;
    <span style="color: #b1b100;">do</span> <span style="color: #000000;">&#123;</span>
        <span style="color: #0000ff;">$response</span> = <a href="http://www.php3.de/fgets"><span style="color: #000066;">fgets</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$fp</span>, <span style="color: #cc66cc;">1024</span><span style="color: #000000;">&#41;</span>;
    <span style="color: #000000;">&#125;</span>
    <span style="color: #b1b100;">while</span> <span style="color: #000000;">&#40;</span>!<a href="http://www.php3.de/feof"><span style="color: #000066;">feof</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$fp</span><span style="color: #000000;">&#41;</span> &amp;&amp; !<a href="http://www.php3.de/stristr"><span style="color: #000066;">stristr</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$response</span>, <span style="color: #ff0000;">'Location'</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
&nbsp;
    <a href="http://www.php3.de/fclose"><span style="color: #000066;">fclose</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$fp</span><span style="color: #000000;">&#41;</span>;
&nbsp;
    <span style="color: #b1b100;">if</span> <span style="color: #000000;">&#40;</span><a href="http://www.php3.de/strstr"><span style="color: #000066;">strstr</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$response</span>, <span style="color: #ff0000;">'online1'</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #ff0000;">'online'</span>;
    <span style="color: #b1b100;">if</span> <span style="color: #000000;">&#40;</span><a href="http://www.php3.de/strstr"><span style="color: #000066;">strstr</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$response</span>, <span style="color: #ff0000;">'online0'</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #ff0000;">'offline'</span>;
    <span style="color: #b1b100;">if</span> <span style="color: #000000;">&#40;</span><a href="http://www.php3.de/strstr"><span style="color: #000066;">strstr</span></a><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">$response</span>, <span style="color: #ff0000;">'online2'</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #ff0000;">'disabled'</span>;
    <span style="color: #808080; font-style: italic;">// disabled meint, dass der Benutzer eingestellt hat, dass sein </span>
    <span style="color: #808080; font-style: italic;">// Status im Web nicht angezeigt wird.</span>
&nbsp;
    <span style="color: #b1b100;">return</span> <span style="color: #000000; font-weight: bold;">FALSE</span>;
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">// Aufruf:</span>
<a href="http://www.php3.de/echo"><span style="color: #000066;">echo</span></a> GetICQ<span style="color: #000000;">&#40;</span><span style="color: #cc66cc;">12423456</span><span style="color: #000000;">&#41;</span>;</pre>

